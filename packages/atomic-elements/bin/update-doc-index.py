import subprocess


TEMPLATE = """
<!-- This file is generated by bin/update-doc-index.py -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <title>Atomic Elements</title>
</head>

<body>
  <main class="container">
    <h1>Atomic Elements</h1>

    <p>Choose a version to view the documentation</p>

    <table>
      <thead>
        <tr>
          <th>Version</th>
        </tr>
      </thead>
      <tbody>
        {rows}
      </tbody>
    </table>
  </main>

</body>

</html>
"""

start_version = "1.0.1"


def main():
    res = subprocess.run(
        "git for-each-ref --sort=creatordate --format '%(refname)' refs/tags",
        shell=True,
        check=True,
        capture_output=True,
    )

    versions = [
        v.split("/")[-1]
        for v in res.stdout.decode("utf-8").strip().split("\n")
        if not "-" in v
    ]

    start_index = versions.index(start_version)
    versions = versions[start_index:]

    print("Versions:", ", ".join(versions))

    rows = []

    rows.append(f"<tr><td><a href='next'>Next</a></td></tr>")

    for v in reversed(versions):
        rows.append(f"<tr><td><a href='{v}'>{v}</a></td></tr>")

    with open("docs/index.html", "w") as f:
        f.write(TEMPLATE.format(rows="\n".join(rows)))


main()
