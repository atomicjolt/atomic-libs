import{r as g}from"./index-DJO9vBfz.js";import{r as ne}from"./index-DJdX7xnk.js";import{$ as ie}from"./FocusScope-BnAoeAyt.js";import{i as le,j as se,$ as W,k as Z,l as J}from"./focusSafely-BOUv7I-8.js";import{a as j}from"./useObjectRef-CA0MXmrf.js";import{e as ce,$ as re,a as oe,f as ae}from"./usePress-DBLAzBwe.js";import{$ as Q}from"./useEvent-D91OnqQ2.js";import{$ as ue,a as X}from"./scrollIntoView-DuDju04b.js";import{$ as fe}from"./context-BQ3_Es2z.js";import{$ as de}from"./useDescription-DnVXAhCi.js";const pe=500;function ye(i){let{isDisabled:e,onLongPressStart:t,onLongPressEnd:l,onLongPress:c,threshold:y=pe,accessibilityDescription:a}=i;const u=g.useRef(void 0);let{addGlobalListener:p,removeGlobalListener:M}=ce(),{pressProps:$}=re({isDisabled:e,onPressStart(s){if(s.continuePropagation(),(s.pointerType==="mouse"||s.pointerType==="touch")&&(t&&t({...s,type:"longpressstart"}),u.current=setTimeout(()=>{s.target.dispatchEvent(new PointerEvent("pointercancel",{bubbles:!0})),c&&c({...s,type:"longpress"}),u.current=void 0},y),s.pointerType==="touch")){let f=L=>{L.preventDefault()};p(s.target,"contextmenu",f,{once:!0}),p(window,"pointerup",()=>{setTimeout(()=>{M(s.target,"contextmenu",f)},30)},{once:!0})}},onPressEnd(s){u.current&&clearTimeout(u.current),l&&(s.pointerType==="mouse"||s.pointerType==="touch")&&l({...s,type:"longpressend"})}}),E=de(c&&!e?a:void 0);return{longPressProps:j($,E)}}function we(i,e){return typeof e.getChildren=="function"?e.getChildren(i.key):i.childNodes}function Ae(i){return be(i,0)}function be(i,e){if(e<0)return;let t=0;for(let l of i){if(t===e)return l;t++}}function Ee(i){let e;for(let t of i)e=t;return e}function Le(i,e,t){if(e.parentKey===t.parentKey)return e.index-t.index;let l=[..._(i,e),e],c=[..._(i,t),t],y=l.slice(0,c.length).findIndex((a,u)=>a!==c[u]);return y!==-1?(e=l[y],t=c[y],e.index-t.index):l.findIndex(a=>a===t)>=0?1:(c.findIndex(a=>a===e)>=0,-1)}function _(i,e){let t=[],l=e;for(;(l==null?void 0:l.parentKey)!=null;)l=i.getItem(l.parentKey),l&&t.unshift(l);return t}function q(i){return le()?i.altKey:i.ctrlKey}function I(i){return se()?i.metaKey:i.ctrlKey}const $e=1e3;function ve(i){let{keyboardDelegate:e,selectionManager:t,onTypeSelect:l}=i,c=g.useRef({search:"",timeout:null}).current,y=a=>{let u=me(a.key);if(!u||a.ctrlKey||a.metaKey||!a.currentTarget.contains(a.target))return;u===" "&&c.search.trim().length>0&&(a.preventDefault(),"continuePropagation"in a||a.stopPropagation()),c.search+=u;let p=e.getKeyForSearch(c.search,t.focusedKey);p==null&&(p=e.getKeyForSearch(c.search)),p!=null&&(t.setFocusedKey(p),l&&l(p)),clearTimeout(c.timeout),c.timeout=setTimeout(()=>{c.search=""},$e)};return{typeSelectProps:{onKeyDownCapture:e.getKeyForSearch?y:null}}}function me(i){return i.length===1||!/^[A-Z]/i.test(i)?i:""}function Oe(i){let{selectionManager:e,keyboardDelegate:t,ref:l,autoFocus:c=!1,shouldFocusWrap:y=!1,disallowEmptySelection:a=!1,disallowSelectAll:u=!1,selectOnFocus:p=e.selectionBehavior==="replace",disallowTypeAhead:M=!1,shouldUseVirtualFocus:$,allowsTabNavigation:E=!1,isVirtualized:s,scrollRef:f=l,linkBehavior:L="action"}=i,{direction:x}=fe(),v=oe(),C=r=>{if(r.altKey&&r.key==="Tab"&&r.preventDefault(),!l.current.contains(r.target))return;const d=(n,A)=>{if(n!=null){if(e.isLink(n)&&L==="selection"&&p&&!q(r)){ne.flushSync(()=>{e.setFocusedKey(n,A)});let O=f.current.querySelector(`[data-key="${CSS.escape(n.toString())}"]`),Y=e.getItemProps(n);v.open(O,r,Y.href,Y.routerOptions);return}if(e.setFocusedKey(n,A),e.isLink(n)&&L==="override")return;r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):p&&!q(r)&&e.replaceSelection(n)}};switch(r.key){case"ArrowDown":if(t.getKeyBelow){var m,b,P;let n=e.focusedKey!=null?(m=t.getKeyBelow)===null||m===void 0?void 0:m.call(t,e.focusedKey):(b=t.getFirstKey)===null||b===void 0?void 0:b.call(t);n==null&&y&&(n=(P=t.getFirstKey)===null||P===void 0?void 0:P.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),d(n))}break;case"ArrowUp":if(t.getKeyAbove){var S,R,o;let n=e.focusedKey!=null?(S=t.getKeyAbove)===null||S===void 0?void 0:S.call(t,e.focusedKey):(R=t.getLastKey)===null||R===void 0?void 0:R.call(t);n==null&&y&&(n=(o=t.getLastKey)===null||o===void 0?void 0:o.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),d(n))}break;case"ArrowLeft":if(t.getKeyLeftOf){var D,N,V;let n=(D=t.getKeyLeftOf)===null||D===void 0?void 0:D.call(t,e.focusedKey);n==null&&y&&(n=x==="rtl"?(N=t.getFirstKey)===null||N===void 0?void 0:N.call(t,e.focusedKey):(V=t.getLastKey)===null||V===void 0?void 0:V.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),d(n,x==="rtl"?"first":"last"))}break;case"ArrowRight":if(t.getKeyRightOf){var G,z,H;let n=(G=t.getKeyRightOf)===null||G===void 0?void 0:G.call(t,e.focusedKey);n==null&&y&&(n=x==="rtl"?(z=t.getLastKey)===null||z===void 0?void 0:z.call(t,e.focusedKey):(H=t.getFirstKey)===null||H===void 0?void 0:H.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),d(n,x==="rtl"?"last":"first"))}break;case"Home":if(t.getFirstKey){r.preventDefault();let n=t.getFirstKey(e.focusedKey,I(r));e.setFocusedKey(n),I(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):p&&e.replaceSelection(n)}break;case"End":if(t.getLastKey){r.preventDefault();let n=t.getLastKey(e.focusedKey,I(r));e.setFocusedKey(n),I(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):p&&e.replaceSelection(n)}break;case"PageDown":if(t.getKeyPageBelow){let n=t.getKeyPageBelow(e.focusedKey);n!=null&&(r.preventDefault(),d(n))}break;case"PageUp":if(t.getKeyPageAbove){let n=t.getKeyPageAbove(e.focusedKey);n!=null&&(r.preventDefault(),d(n))}break;case"a":I(r)&&e.selectionMode==="multiple"&&u!==!0&&(r.preventDefault(),e.selectAll());break;case"Escape":!a&&e.selectedKeys.size!==0&&(r.stopPropagation(),r.preventDefault(),e.clearSelection());break;case"Tab":if(!E){if(r.shiftKey)l.current.focus();else{let n=ie(l.current,{tabbable:!0}),A,O;do O=n.lastChild(),O&&(A=O);while(O);A&&!A.contains(document.activeElement)&&J(A)}break}}},K=g.useRef({top:0,left:0});Q(f,"scroll",s?null:()=>{K.current={top:f.current.scrollTop,left:f.current.scrollLeft}});let B=r=>{if(e.isFocused){r.currentTarget.contains(r.target)||e.setFocused(!1);return}if(r.currentTarget.contains(r.target)){if(e.setFocused(!0),e.focusedKey==null){let b=S=>{S!=null&&(e.setFocusedKey(S),p&&e.replaceSelection(S))},P=r.relatedTarget;var d,m;P&&r.currentTarget.compareDocumentPosition(P)&Node.DOCUMENT_POSITION_FOLLOWING?b((d=e.lastSelectedKey)!==null&&d!==void 0?d:t.getLastKey()):b((m=e.firstSelectedKey)!==null&&m!==void 0?m:t.getFirstKey())}else s||(f.current.scrollTop=K.current.top,f.current.scrollLeft=K.current.left);if(e.focusedKey!=null){let b=f.current.querySelector(`[data-key="${CSS.escape(e.focusedKey.toString())}"]`);b&&(b.contains(document.activeElement)||J(b),Z()==="keyboard"&&X(b,{containingElement:l.current}))}}},k=r=>{r.currentTarget.contains(r.relatedTarget)||e.setFocused(!1)};const h=g.useRef(c);g.useEffect(()=>{if(h.current){let r=null;c==="first"&&(r=t.getFirstKey()),c==="last"&&(r=t.getLastKey());let d=e.selectedKeys;if(d.size){for(let m of d)if(e.canSelectItem(m)){r=m;break}}e.setFocused(!0),e.setFocusedKey(r),r==null&&!$&&W(l.current)}},[]);let T=g.useRef(e.focusedKey);g.useEffect(()=>{if(e.isFocused&&e.focusedKey!=null&&(e.focusedKey!==T.current||h.current)&&(f!=null&&f.current)){let r=Z(),d=l.current.querySelector(`[data-key="${CSS.escape(e.focusedKey.toString())}"]`);if(!d)return;(r==="keyboard"||h.current)&&(ue(f.current,d),r!=="virtual"&&X(d,{containingElement:l.current}))}!$&&e.isFocused&&e.focusedKey==null&&T.current!=null&&W(l.current),T.current=e.focusedKey,h.current=!1}),Q(l,"react-aria-focus-scope-restore",r=>{r.preventDefault(),e.setFocused(!0)});let F={onKeyDown:C,onFocus:B,onBlur:k,onMouseDown(r){f.current===r.target&&r.preventDefault()}},{typeSelectProps:U}=ve({keyboardDelegate:t,selectionManager:e});M||(F=j(U,F));let w;return $||(w=e.focusedKey==null?0:-1),{collectionProps:{...F,tabIndex:w}}}function Ie(i){let{selectionManager:e,key:t,ref:l,shouldSelectOnPressUp:c,shouldUseVirtualFocus:y,focus:a,isDisabled:u,onAction:p,allowsDifferentPressOrigin:M,linkBehavior:$="action"}=i,E=oe(),s=o=>{if(o.pointerType==="keyboard"&&q(o))e.toggleSelection(t);else{if(e.selectionMode==="none")return;if(e.isLink(t)){if($==="selection"){let D=e.getItemProps(t);E.open(l.current,o,D.href,D.routerOptions),e.setSelectedKeys(e.selectedKeys);return}else if($==="override"||$==="none")return}e.selectionMode==="single"?e.isSelected(t)&&!e.disallowEmptySelection?e.toggleSelection(t):e.replaceSelection(t):o&&o.shiftKey?e.extendSelection(t):e.selectionBehavior==="toggle"||o&&(I(o)||o.pointerType==="touch"||o.pointerType==="virtual")?e.toggleSelection(t):e.replaceSelection(t)}};g.useEffect(()=>{t===e.focusedKey&&e.isFocused&&!y&&(a?a():document.activeElement!==l.current&&W(l.current))},[l,t,e.focusedKey,e.childFocusStrategy,e.isFocused,y]),u=u||e.isDisabled(t);let f={};!y&&!u?f={tabIndex:t===e.focusedKey?0:-1,onFocus(o){o.target===l.current&&e.setFocusedKey(t)}}:u&&(f.onMouseDown=o=>{o.preventDefault()});let L=e.isLink(t)&&$==="override",x=e.isLink(t)&&$!=="selection"&&$!=="none",v=!u&&e.canSelectItem(t)&&!L,C=(p||x)&&!u,K=C&&(e.selectionBehavior==="replace"?!v:!v||e.isEmpty),B=C&&v&&e.selectionBehavior==="replace",k=K||B,h=g.useRef(null),T=k&&v,F=g.useRef(!1),U=g.useRef(!1),w=o=>{if(p&&p(),x){let D=e.getItemProps(t);E.open(l.current,o,D.href,D.routerOptions)}},r={};c?(r.onPressStart=o=>{h.current=o.pointerType,F.current=T,o.pointerType==="keyboard"&&(!k||te())&&s(o)},M?(r.onPressUp=K?null:o=>{o.pointerType!=="keyboard"&&v&&s(o)},r.onPress=K?w:null):r.onPress=o=>{if(K||B&&o.pointerType!=="mouse"){if(o.pointerType==="keyboard"&&!ee())return;w(o)}else o.pointerType!=="keyboard"&&v&&s(o)}):(r.onPressStart=o=>{h.current=o.pointerType,F.current=T,U.current=K,v&&(o.pointerType==="mouse"&&!K||o.pointerType==="keyboard"&&(!C||te()))&&s(o)},r.onPress=o=>{(o.pointerType==="touch"||o.pointerType==="pen"||o.pointerType==="virtual"||o.pointerType==="keyboard"&&k&&ee()||o.pointerType==="mouse"&&U.current)&&(k?w(o):v&&s(o))}),f["data-key"]=t,r.preventFocusOnPress=y;let{pressProps:d,isPressed:m}=re(r),b=B?o=>{h.current==="mouse"&&(o.stopPropagation(),o.preventDefault(),w(o))}:void 0,{longPressProps:P}=ye({isDisabled:!T,onLongPress(o){o.pointerType==="touch"&&(s(o),e.setSelectionBehavior("toggle"))}}),S=o=>{h.current==="touch"&&F.current&&o.preventDefault()},R=e.isLink(t)?o=>{ae.isOpening||o.preventDefault()}:void 0;return{itemProps:j(f,v||K?d:{},T?P:{},{onDoubleClick:b,onDragStartCapture:S,onClick:R}),isPressed:m,isSelected:e.isSelected(t),isFocused:e.isFocused&&e.focusedKey===t,isDisabled:u,allowsSelection:v,hasAction:k}}function ee(){let i=window.event;return(i==null?void 0:i.key)==="Enter"}function te(){let i=window.event;return(i==null?void 0:i.key)===" "||(i==null?void 0:i.code)==="Space"}export{we as $,Oe as a,ve as b,Le as c,Ae as d,Ie as e,ye as f,Ee as g,be as h};
