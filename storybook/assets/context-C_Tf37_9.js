import{b as P}from"./FocusScope-BnAoeAyt.js";import{r as D,R as I}from"./index-DJO9vBfz.js";import{$ as M}from"./useFocusWithin-DSbUfD8x.js";import{b as N,h as R}from"./focusSafely-BOUv7I-8.js";import{c as x,e as L}from"./useObjectRef-BKue9pYL.js";import{$ as F}from"./useLayoutEffect-Bj1hLagI.js";import{$ as C}from"./getScrollParent-BL0kfGii.js";function W(e){let{ref:n,onInteractOutside:o,isDisabled:a,onInteractOutsideStart:u}=e,p=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),s=x(r=>{o&&w(r,n)&&(u&&u(r),p.current.isPointerDown=!0)}),c=x(r=>{o&&o(r)});D.useEffect(()=>{let r=p.current;if(a)return;const i=n.current,t=N(i);if(typeof PointerEvent<"u"){let f=d=>{r.isPointerDown&&w(d,n)&&c(d),r.isPointerDown=!1};return t.addEventListener("pointerdown",s,!0),t.addEventListener("pointerup",f,!0),()=>{t.removeEventListener("pointerdown",s,!0),t.removeEventListener("pointerup",f,!0)}}else{let f=v=>{r.ignoreEmulatedMouseEvents?r.ignoreEmulatedMouseEvents=!1:r.isPointerDown&&w(v,n)&&c(v),r.isPointerDown=!1},d=v=>{r.ignoreEmulatedMouseEvents=!0,r.isPointerDown&&w(v,n)&&c(v),r.isPointerDown=!1};return t.addEventListener("mousedown",s,!0),t.addEventListener("mouseup",f,!0),t.addEventListener("touchstart",s,!0),t.addEventListener("touchend",d,!0),()=>{t.removeEventListener("mousedown",s,!0),t.removeEventListener("mouseup",f,!0),t.removeEventListener("touchstart",s,!0),t.removeEventListener("touchend",d,!0)}}},[n,a,s,c])}function w(e,n){if(e.button>0)return!1;if(e.target){const o=e.target.ownerDocument;if(!o||!o.documentElement.contains(e.target)||e.target.closest("[data-react-aria-top-layer]"))return!1}return n.current&&!n.current.contains(e.target)}const $=[];function J(e,n){let{onClose:o,shouldCloseOnBlur:a,isOpen:u,isDismissable:p=!1,isKeyboardDismissDisabled:s=!1,shouldCloseOnInteractOutside:c}=e;D.useEffect(()=>(u&&$.push(n),()=>{let l=$.indexOf(n);l>=0&&$.splice(l,1)}),[u,n]);let r=()=>{$[$.length-1]===n&&o&&o()},i=l=>{(!c||c(l.target))&&$[$.length-1]===n&&(l.stopPropagation(),l.preventDefault())},t=l=>{(!c||c(l.target))&&($[$.length-1]===n&&(l.stopPropagation(),l.preventDefault()),r())},f=l=>{l.key==="Escape"&&!s&&!l.nativeEvent.isComposing&&(l.stopPropagation(),l.preventDefault(),r())};W({ref:n,onInteractOutside:p&&u?t:null,onInteractOutsideStart:i});let{focusWithinProps:d}=M({isDisabled:!a,onBlurWithin:l=>{!l.relatedTarget||P(l.relatedTarget)||(!c||c(l.relatedTarget))&&o()}}),v=l=>{l.target===l.currentTarget&&l.preventDefault()};return{overlayProps:{onKeyDown:f,...d},underlayProps:{onPointerDown:v}}}const T=typeof document<"u"&&window.visualViewport,A=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let g=0,y;function X(e={}){let{isDisabled:n}=e;F(()=>{if(!n)return g++,g===1&&(R()?y=_():y=H()),()=>{g--,g===0&&y()}},[n])}function H(){return L(E(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`),E(document.documentElement,"overflow","hidden"))}function _(){let e,n,o=i=>{e=C(i.target,!0),!(e===document.documentElement&&e===document.body)&&e instanceof HTMLElement&&window.getComputedStyle(e).overscrollBehavior==="auto"&&(n=E(e,"overscrollBehavior","contain"))},a=i=>{if(!e||e===document.documentElement||e===document.body){i.preventDefault();return}e.scrollHeight===e.clientHeight&&e.scrollWidth===e.clientWidth&&i.preventDefault()},u=i=>{let t=i.target;S(t)&&t!==document.activeElement&&(i.preventDefault(),c(),t.style.transform="translateY(-2000px)",t.focus(),requestAnimationFrame(()=>{t.style.transform=""})),n&&n()},p=i=>{let t=i.target;S(t)&&(c(),t.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{t.style.transform="",T&&(T.height<window.innerHeight?requestAnimationFrame(()=>{O(t)}):T.addEventListener("resize",()=>O(t),{once:!0}))}))},s=null,c=()=>{if(s)return;let i=()=>{window.scrollTo(0,0)},t=window.pageXOffset,f=window.pageYOffset;s=L(b(window,"scroll",i),E(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`),E(document.documentElement,"overflow","hidden"),E(document.body,"marginTop",`-${f}px`),()=>{window.scrollTo(t,f)}),window.scrollTo(0,0)},r=L(b(document,"touchstart",o,{passive:!1,capture:!0}),b(document,"touchmove",a,{passive:!1,capture:!0}),b(document,"touchend",u,{passive:!1,capture:!0}),b(document,"focus",p,!0));return()=>{n==null||n(),s==null||s(),r()}}function E(e,n,o){let a=e.style[n];return e.style[n]=o,()=>{e.style[n]=a}}function b(e,n,o,a){return e.addEventListener(n,o,a),()=>{e.removeEventListener(n,o,a)}}function O(e){let n=document.scrollingElement||document.documentElement;for(;e&&e!==n;){let o=C(e);if(o!==document.documentElement&&o!==document.body&&o!==e){let a=o.getBoundingClientRect().top,u=e.getBoundingClientRect().top;u>a+e.clientHeight&&(o.scrollTop+=u-a)}e=o.parentElement}}function S(e){return e instanceof HTMLInputElement&&!A.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}let h=new WeakMap,m=[];function j(e,n=document.body){let o=new Set(e),a=new Set,u=r=>{for(let d of r.querySelectorAll("[data-live-announcer], [data-react-aria-top-layer]"))o.add(d);let i=d=>{if(o.has(d)||a.has(d.parentElement)&&d.parentElement.getAttribute("role")!=="row")return NodeFilter.FILTER_REJECT;for(let v of o)if(d.contains(v))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:i}),f=i(r);if(f===NodeFilter.FILTER_ACCEPT&&p(r),f!==NodeFilter.FILTER_REJECT){let d=t.nextNode();for(;d!=null;)p(d),d=t.nextNode()}},p=r=>{var i;let t=(i=h.get(r))!==null&&i!==void 0?i:0;r.getAttribute("aria-hidden")==="true"&&t===0||(t===0&&r.setAttribute("aria-hidden","true"),a.add(r),h.set(r,t+1))};m.length&&m[m.length-1].disconnect(),u(n);let s=new MutationObserver(r=>{for(let i of r)if(!(i.type!=="childList"||i.addedNodes.length===0)&&![...o,...a].some(t=>t.contains(i.target))){for(let t of i.removedNodes)t instanceof Element&&(o.delete(t),a.delete(t));for(let t of i.addedNodes)(t instanceof HTMLElement||t instanceof SVGElement)&&(t.dataset.liveAnnouncer==="true"||t.dataset.reactAriaTopLayer==="true")?o.add(t):t instanceof Element&&u(t)}});s.observe(n,{childList:!0,subtree:!0});let c={observe(){s.observe(n,{childList:!0,subtree:!0})},disconnect(){s.disconnect()}};return m.push(c),()=>{s.disconnect();for(let r of a){let i=h.get(r);i===1?(r.removeAttribute("aria-hidden"),h.delete(r)):h.set(r,i-1)}c===m[m.length-1]?(m.pop(),m.length&&m[m.length-1].observe()):m.splice(m.indexOf(c),1)}}const z=I.createContext(null);export{J as $,z as O,X as a,j as b};
